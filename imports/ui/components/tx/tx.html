<template name="tx">
  <div class="space-y-6">
    {{#if txLoading}}
      <div class="card">
        <div class="flex items-center justify-center py-12">
          <div class="flex flex-col items-center space-y-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-qrl-accent"></div>
            <div class="text-qrl-text-secondary">Loading transaction data...</div>
          </div>
        </div>
      </div>
    {{else if notFound}}
      <div class="card border-red-500/30 bg-red-500/10">
        <div class="flex items-start space-x-3">
          <div class="flex-shrink-0">
            <svg class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-red-400 mb-2">
              Transaction Not Found
            </h3>
            <p class="text-red-300 break-all">
              Transaction <span class="font-mono">{{id}}</span> not found
            </p>
          </div>
        </div>
      </div>
    {{/if}}

    {{#with tx}}
      {{#if error}}
        <div class="card border-red-500/30 bg-red-500/10">
          <div class="flex items-start space-x-3">
            <div class="flex-shrink-0">
              <svg class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-red-400 mb-2">
                Error reading transaction
              </h3>
              <p class="text-red-300">{{tx.error}}</p>
            </div>
          </div>
        </div>
      {{else}}
        <!-- Transaction Header -->
        <div class="card">
          <div class="mb-4">
            <div class="text-xs font-medium text-qrl-text-secondary uppercase tracking-wider mb-2">TRANSACTION</div>
            <div class="flex items-center gap-3 txhash-container">
              <h3 class="text-2xl font-bold text-qrl-text font-mono flex-1 min-w-0 truncate" title="{{tx.tx.transaction_hash}}">
                {{tx.tx.transaction_hash}}
              </h3>
              <button class="copy-txhash-btn flex items-center gap-2 px-3 py-2 bg-qrl-accent/10 hover:bg-qrl-accent/20 text-qrl-accent rounded-lg transition-colors duration-200 text-sm font-medium min-h-[40px] cursor-pointer" title="Copy transaction hash to clipboard" style="pointer-events: auto !important;">
                <i data-lucide="copy" class="w-4 h-4 flex-shrink-0 pointer-events-none"></i>
                <span class="hidden sm:inline whitespace-nowrap pointer-events-none">Copy</span>
              </button>
            </div>
          </div>

          <!-- Transaction Status -->
          <div class="flex justify-center">
            <div class="bg-qrl-primary/50 rounded-lg p-4 max-w-sm">
              <div class="text-sm text-qrl-text-secondary mb-1 text-center">Status</div>
              <div class="text-md font-mono text-qrl-text flex items-center justify-center">
                {{#if isConfirmed}}
                  <i data-lucide="check-circle" class="w-4 h-4 text-green-400 mr-2"></i>
                  OK {{ts}}
                {{else}}
                  <i data-lucide="clock" class="w-4 h-4 text-yellow-400 mr-2"></i>
                  Unconfirmed
                {{/if}}
              </div>
            </div>
          </div>

          <!-- Transaction Type and Amount - Full Width -->
          <div class="text-center mb-6">
            <div class="bg-qrl-secondary/50 rounded-lg p-6">
              <div class="mb-4">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium {{#if isTransfer}}bg-yellow-100 text-yellow-800{{else}}{{#if isTokenTransfer}}bg-blue-100 text-blue-800{{else}}bg-gray-100 text-gray-800{{/if}}{{/if}}">
                  {{explorer.type}}{{#if isTokenTransfer}}{{#if isTransferNFT}}{{else}}: {{explorer.symbol}} {{/if}}{{/if}}
                </span>
              </div>

                {{#if isNotMultiSig}}
                  {{#if isNotMessage}}
                    {{#if isNotLattice}}
                      {{#if isToken}}
                        <div class="text-lg font-semibold text-qrl-text mb-2">
                          <strong>{{explorer.name}} ({{explorer.symbol}})</strong>
                        </div>
                        <div class="text-qrl-text-secondary mb-2">owned by:</div>
                        <div class="font-mono text-qrl-accent">
                           <a href="/a/{{#if bech32}}{{explorer.owner_b32}}{{else}}{{explorer.owner_hex}}{{/if}}" class="hover:text-qrl-accent/80">
                             {{#if bech32}}{{explorer.owner_b32}}{{else}}{{explorer.owner_hex}}{{/if}}
                          </a>
                        </div>
                      {{else}}
                        {{#if isTokenTransfer}}
                          {{#if isTransferNFT}}
                            {{#if knownProvider}}
                              <div class="mb-4">
                                <svg class="inline-block w-5 h-5 text-qrl-accent mr-1" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                Verified provider:
                                <a href="{{providerURL}}/{{explorer.token_txhash}}" class="text-qrl-accent hover:text-qrl-accent/80">{{providerName}}</a> ({{providerID}})
                              </div>
                            {{else}}
                              <div class="mb-4">
                                <i data-lucide="alert-triangle" class="inline-block w-5 h-5 text-yellow-400 mr-1"></i>
                                Unverified provider: {{providerID}}
                              </div>
                            {{/if}}
                            
                            <div class="text-2xl font-bold text-qrl-text mb-2">{{explorer.totalTransferred}}</div>
                            <div class="text-qrl-text-secondary mb-4">NFT transferred</div>
                            
                            <div class="text-sm text-qrl-text-secondary mb-2">NFT creation transaction:</div>
                            <div class="font-mono text-sm break-all mb-4">
                              <a href="/tx/{{explorer.token_txhash}}" class="text-qrl-accent hover:text-qrl-accent/80">{{explorer.token_txhash}}</a>
                            </div>
                            
                            {{#if knownProvider}}
                              <a href="{{providerURL}}/{{explorer.token_txhash}}" class="btn-primary">
                                <i data-lucide="external-link" class="w-4 h-4 mr-2"></i>
                                View at {{providerName}}
                              </a>
                            {{/if}}
                          {{else}}
                            <div class="text-2xl font-bold text-qrl-text mb-2">{{explorer.totalTransferred}}</div>
                            <div class="text-qrl-text-secondary mb-2">{{explorer.symbol}} ({{explorer.name}}) tokens transferred</div>
                            
                            <div class="text-sm text-qrl-text-secondary mb-2">Token creation transaction:</div>
                            <div class="font-mono text-sm break-all">
                              <a href="/tx/{{explorer.token_txhash}}" class="text-qrl-accent hover:text-qrl-accent/80">{{explorer.token_txhash}}</a>
                            </div>
                          {{/if}}
                        {{else}}
                          {{#if isCreateNFT}}
                            <!-- NFT Creation -->
                          {{else}}
                            <div class="text-2xl font-bold text-qrl-text mb-2 relative group cursor-help" data-tooltip="USD ${{#if tx.tx.coinbase}}{{coinbaseUSD}}{{else if tx.tx.transfer}}{{transferUSD}}{{else}}{{qrl}}{{/if}}">
                              {{tx.tx.amount}}
                              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-qrl-primary text-qrl-text text-sm rounded-lg shadow-lg opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10">
                                USD ${{#if tx.tx.coinbase}}{{coinbaseUSD}}{{else if tx.tx.transfer}}{{transferUSD}}{{else}}{{qrlFormatted}}{{/if}}
                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-qrl-primary"></div>
                              </div>
                            </div>
                            <div class="text-qrl-text-secondary">
                              Quanta
                            </div>
                          {{/if}}
                        {{/if}}
                      {{/if}}
                    {{/if}}
                  {{else}}
                    {{#if isMultiSigSpend}}
                      <div class="text-lg font-mono text-qrl-accent break-all">
                        <a href="/a/{{multiSigSpendAddress}}" class="hover:text-qrl-accent/80">{{multiSigSpendAddress}}</a>
                      </div>
                    {{else}}
                      {{#if isMultiSigVote}}
                        <!-- MultiSig Vote -->
                      {{else}}
                        <div class="text-lg font-mono text-qrl-accent break-all">
                          <a href="/a/{{multiSigAddress}}" class="hover:text-qrl-accent/80">{{multiSigAddress}}</a>
                        </div>
                      {{/if}}
                    {{/if}}
                  {{/if}}
                {{/if}}
              </div>

            <!-- Transaction Details -->
            <div class="space-y-6">
              {{#if isToken}}
                <!-- Token Initial Balances -->
                <div>
                  <h4 class="text-lg font-semibold text-qrl-text mb-4">Initial Balances</h4>
                  <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-qrl-border">
                      <thead class="bg-qrl-primary/50">
                        <tr>
                          <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Address</th>
                          <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Balance</th>
                        </tr>
                      </thead>
                      <tbody class="bg-qrl-secondary divide-y divide-qrl-border">
                        {{#each explorer.initialBalances}}
                          <tr>
                            <td class="px-4 py-2 text-sm font-mono text-left">
                               <a href="/a/{{#if bech32}}{{this.address_b32}}{{else}}{{this.address_hex}}{{/if}}" class="text-qrl-accent hover:text-qrl-accent/80">
                                 {{#if bech32}}{{this.address_b32}}{{else}}{{this.address_hex}}{{/if}}
                              </a>
                            </td>
                            <td class="px-4 py-2 text-sm text-qrl-text">{{this.amount}}</td>
                          </tr>
                        {{/each}}
                      </tbody>
                    </table>
                  </div>
                </div>
              {{else}}
                {{#if isNotCoinbase}}
                  <!-- From Address -->
                  <div class="bg-qrl-primary/50 rounded-lg p-4">
                    <div class="flex items-center justify-center mb-2">
                      <h3 class="text-lg font-semibold text-qrl-text mb-4">
                        <span>
                          {{#if isMultiSigSpend}}initiated by{{else}}From{{/if}}
                        </span>
                        <i data-lucide="arrow-right" class="inline w-5 h-5 text-red-400 mr-2"></i>
                      </h3>
                    </div>
                    <div class="overflow-x-auto">
                      <table class="min-w-full divide-y divide-qrl-border">
                        <thead class="bg-qrl-secondary">
                          <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Address</th>
                          </tr>
                        </thead>
                        <tbody class="bg-qrl-secondary divide-y divide-qrl-border">
                          <tr>
                            <td class="px-4 py-2 text-sm font-mono text-left">
                              <a href="/a/{{#if bech32}}{{explorer.from_b32}}{{else}}{{explorer.from_hex}}{{/if}}" class="text-qrl-accent hover:text-qrl-accent/80">
                                {{#if bech32}}{{explorer.from_b32}}{{else}}{{explorer.from_hex}}{{/if}}
                              </a>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                {{/if}}

                {{#if isMessage}}
                  <!-- Message Content -->
                  <div class="bg-qrl-primary/50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-qrl-text mb-3">Message</h3>
                    <pre class="text-sm text-qrl-text font-mono whitespace-pre-wrap">{{explorer.message}}</pre>
                  </div>
                {{else}}
                  {{#if isDocumentNotarisation}}
                    <!-- Document Notarisation -->
                    <div class="space-y-6">
                      <div class="bg-qrl-primary/50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-qrl-text mb-4">Document Notarisation</h3>
                        <div class="space-y-3 text-sm">
                          <div>
                            <span class="font-medium text-qrl-text-secondary">Notary:</span>
                             <span class="font-mono text-qrl-text">{{#if bech32}}{{explorer.from_b32}}{{else}}{{explorer.from_hex}}{{/if}}</span>
                          </div>
                          <div>
                            <span class="font-medium text-qrl-text-secondary">Hash Function:</span>
                            <span class="font-mono text-qrl-text">{{explorer.hash_function}}</span>
                          </div>
                          <div>
                            <span class="font-medium text-qrl-text-secondary">File Hash:</span>
                            <span class="font-mono text-qrl-text break-all">{{explorer.hash}}</span>
                          </div>
                          <div>
                            <span class="font-medium text-qrl-text-secondary">Additional Text:</span>
                            <span class="font-mono text-qrl-text">{{explorer.text}}</span>
                          </div>
                        </div>
                      </div>

                      <!-- Verification Form -->
                      <div class="bg-qrl-primary/50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-qrl-text mb-4">Verify Notarisation</h3>
                        <form id="notariseVerificationForm" class="space-y-4">
                          <div>
                            <label class="block text-sm font-medium text-qrl-text-secondary mb-2">Select Document</label>
                            <input type="file" id="notaryDocument" accept="text/json" name="notaryDocument[]" class="w-full px-3 py-2 bg-qrl-secondary border border-qrl-border rounded text-qrl-text" />
                          </div>
                          <div>
                            <button id="verifyNotarisation" class="btn-primary">
                              <i data-lucide="check-circle" class="w-4 h-4 mr-2"></i>
                              Verify Notarisation
                            </button>
                          </div>
                        </form>

                        <!-- Verification Results -->
                        <div id="documentVerified" class="mt-4 p-4 bg-green-500/10 border border-green-500/30 rounded-lg hidden">
                          <h4 class="text-lg font-semibold text-green-400 mb-2">Document Verified</h4>
                          <p class="text-green-300 break-all">{{documentNotarisationVerificationMessage}}</p>
                        </div>
                        <div id="documentVerifcationFailed" class="mt-4 p-4 bg-red-500/10 border border-red-500/30 rounded-lg hidden">
                          <h4 class="text-lg font-semibold text-red-400 mb-2">Document Verification Failed</h4>
                          <p class="text-red-300 break-all">Error: {{documentNotarisationError}}</p>
                        </div>
                      </div>
                    </div>
                  {{else}}
                    {{#if isKeybase}}
                      <!-- Keybase Message -->
                      <div class="bg-qrl-primary/50 rounded-lg p-4">
                        <h4 class="text-lg font-semibold text-qrl-text mb-4">Keybase Message Transaction</h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full divide-y divide-qrl-border">
                            <thead class="bg-qrl-secondary">
                              <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Action</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Keybase User ID</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Keybase Hash</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td class="px-4 py-2 text-sm text-qrl-text">{{this.explorer.keybaseType}}</td>
                                <td class="px-4 py-2 text-sm text-qrl-text">{{this.explorer.keybaseUser}}</td>
                                <td class="px-4 py-2 text-sm text-qrl-text font-mono">{{this.explorer.keybaseHex}}</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    {{else}}
                      {{#if isMultiSigCreate}}
                        <!-- MultiSig Signatories -->
                        <div class="bg-qrl-primary/50 rounded-lg p-4">
                          <h4 class="text-lg font-semibold text-qrl-text mb-4">Signatories</h4>
                          <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-qrl-border">
                              <thead class="bg-qrl-secondary">
                                <tr>
                                  <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Address</th>
                                  <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Weight</th>
                                </tr>
                              </thead>
                              <tbody class="bg-qrl-secondary divide-y divide-qrl-border">
                                {{#each multiSigSignatories this.tx.multi_sig_create}}
                                  <tr>
                                     <td class="px-4 py-2 text-sm font-mono text-left text-qrl-text">{{this.address_hex}}</td>
                                     <td class="px-4 py-2 text-sm text-qrl-text">{{this.weight}}</td>
                                  </tr>
                                {{/each}}
                              </tbody>
                              <tfoot class="bg-qrl-secondary">
                                <tr>
                                  <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary">Threshold for spend</th>
                                   <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text">{{this.tx.multi_sig_create.threshold}}</th>
                                </tr>
                              </tfoot>
                            </table>
                          </div>
                        </div>
                      {{else}}
                        {{#if isMultiSigVote}}
                          <!-- MultiSig Vote -->
                          <div class="bg-qrl-primary/50 rounded-lg p-4">
                            <div class="space-y-3">
                              <div>
                                <span class="font-medium text-qrl-text-secondary">Spend transaction:</span>
                                <div class="font-mono text-sm text-qrl-text break-all">
                                   <a href="/tx/{{this.tx.multi_sig_vote.shared_key}}" class="text-qrl-accent hover:text-qrl-accent/80">{{this.tx.multi_sig_vote.shared_key}}</a>
                                </div>
                              </div>
                              <div>
                                <span class="font-medium text-qrl-text-secondary">Vote status:</span>
                                <span class="text-qrl-text">
                                   {{#if this.tx.multi_sig_vote.unvote}}Vote REJECT spend{{else}}Vote APPROVE spend{{/if}}
                                </span>
                              </div>
                            </div>
                          </div>
                        {{else}}
                          {{#if isLattice}}
                            <!-- Lattice Public Key -->
                            <div class="space-y-4">
                              <div class="bg-qrl-primary/50 rounded-lg p-4">
                                <h4 class="text-lg font-semibold text-qrl-text mb-4">Lattice Public Key</h4>
                                <div class="space-y-3 text-sm">
                                  <div>
                                    <span class="font-medium text-qrl-text-secondary">PK1:</span>
                                    <div class="font-mono text-qrl-text break-all">{{bf this.tx.latticePK.pk1}}</div>
                                  </div>
                                  <div>
                                    <span class="font-medium text-qrl-text-secondary">PK2:</span>
                                    <div class="font-mono text-qrl-text break-all">{{bf this.tx.latticePK.pk2}}</div>
                                  </div>
                                  <div>
                                    <span class="font-medium text-qrl-text-secondary">PK3:</span>
                                    <div class="font-mono text-qrl-text break-all">{{bf this.tx.latticePK.pk3}}</div>
                                  </div>
                                </div>
                              </div>
                              <div class="bg-qrl-primary/50 rounded-lg p-4">
                                <div class="space-y-3 text-sm">
                                  <div>
                                    <span class="font-medium text-qrl-text-secondary">Public Key:</span>
                                    <div class="font-mono text-qrl-text break-all">{{bf this.tx.public_key}}</div>
                                  </div>
                                  <div>
                                    <span class="font-medium text-qrl-text-secondary">Signature:</span>
                                    <div class="font-mono text-qrl-text break-all">{{bf this.tx.signature}}</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          {{else}}
                            {{#if isCreateNFT}}
                              <!-- NFT Creation -->
                              <div class="bg-qrl-primary/50 rounded-lg p-4">
                                <div class="flex items-center mb-4">
                                  {{#if knownProvider}}
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mr-2"></i>
                                    Verified
                                  {{else}}
                                    <svg class="w-5 h-5 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                      <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    Unverified
                                  {{/if}}
                                  <span class="text-qrl-text">provider:</span>
                                </div>
                                <div class="text-sm text-qrl-text-secondary mb-2">
                                  {{#if knownProvider}}
                                    <a href="{{providerURL}}/{{tx.tx.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80">{{providerName}}</a> ({{providerID}})
                                  {{else}}
                                    {{providerID}}
                                  {{/if}}
                                </div>
                                <div class="text-sm text-qrl-text-secondary mb-2">Hash: <span class="font-mono break-all">{{nftHash}}</span></div>
                                <div class="mt-4">
                                  {{#if knownProvider}}
                                    <a href="{{providerURL}}/{{tx.tx.transaction_hash}}" class="btn-primary">
                                      <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                      </svg>
                                      View at {{providerName}}
                                    </a>
                                  {{else}}
                                    <span class="text-qrl-text-secondary">Contact your NFT provider</span>
                                  {{/if}}
                                </div>
                              </div>
                            {{else}}
                              <!-- Transaction Outputs -->
                              <div class="bg-qrl-primary/50 rounded-lg p-4">
                                <h3 class="text-lg font-semibold text-qrl-text mb-4">
                                  <i data-lucide="arrow-right" class="inline w-5 h-5 text-green-400 mr-1"></i>

                                  To
                                </h3>
                                <div class="overflow-x-auto">
                                  <table class="min-w-full divide-y divide-qrl-border">
                                    <thead class="bg-qrl-secondary">
                                      <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Amount</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-qrl-text-secondary uppercase">Address</th>
                                      </tr>
                                    </thead>
                                    <tbody class="bg-qrl-secondary divide-y divide-qrl-border">
                                       {{#if isTransfer}}
                                         {{#each explorer.outputs}}
                                           <tr>
                                             <td class="px-4 py-2 text-sm text-qrl-text text-left">{{this.amount}}</td>
                                             <td class="px-4 py-2 text-sm font-mono text-left">
                                               <a href="/a/{{#if bech32}}{{this.address_b32}}{{else}}{{this.address_hex}}{{/if}}" class="text-qrl-accent hover:text-qrl-accent/80">
                                                 {{#if bech32}}{{this.address_b32}}{{else}}{{this.address_hex}}{{/if}}
                                               </a>
                                             </td>
                                           </tr>
                                         {{/each}}
                                      {{else if isTokenTransfer}}
                                        {{#each explorer.outputs}}
                                          <tr>
                                            <td class="px-4 py-2 text-sm text-qrl-text text-left">{{this.amount}}</td>
                                            <td class="px-4 py-2 text-sm font-mono text-left">
                                              <a href="/a/{{#if bech32}}{{this.address_b32}}{{else}}{{this.address_hex}}{{/if}}" class="text-qrl-accent hover:text-qrl-accent/80">
                                                {{#if bech32}}{{this.address_b32}}{{else}}{{this.address_hex}}{{/if}}
                                              </a>
                                            </td>
                                          </tr>
                                        {{/each}}
                                      {{else if isMultiSigSpend}}
                                        {{#each mso this.tx.multi_sig_spend}}
                                          <tr>
                                            <td class="px-4 py-2 text-sm text-qrl-text text-left">{{this.amount}} Quanta</td>
                                            <td class="px-4 py-2 text-sm font-mono text-left">
                                              <a href="/a/{{this.address}}" class="text-qrl-accent hover:text-qrl-accent/80">{{this.address}}</a>
                                            </td>
                                          </tr>
                                        {{/each}}
                                      {{else}}
                                        <tr>
                                          <td class="px-4 py-2 text-sm text-qrl-text text-left">{{tx.tx.amount}}</td>
                                          <td class="px-4 py-2 text-sm font-mono text-left">
                                            <a href="/a/{{#if bech32}}{{explorer.to_b32}}{{else}}{{explorer.to_hex}}{{/if}}" class="text-qrl-accent hover:text-qrl-accent/80">
                                              {{#if bech32}}{{explorer.to_b32}}{{else}}{{explorer.to_hex}}{{/if}}
                                            </a>
                                          </td>
                                        </tr>
                                      {{/if}}
                                    </tbody>
                                  </table>
                                </div>
                              </div>
                            {{/if}}
                          {{/if}}
                        {{/if}}
                      {{/if}}
                    {{/if}}
                  {{/if}}
                {{/if}}
              {{/if}}

              {{#if hasMessage}}
                <!-- Transfer Message -->
                <div class="bg-qrl-primary/50 rounded-lg p-4">
                  <h3 class="text-lg font-semibold text-qrl-text mb-3">Message</h3>
                  <div class="text-sm text-qrl-text font-mono whitespace-pre-wrap">{{tfMessage}}</div>
                </div>
              {{/if}}
            </div>
          </div>

          <!-- Transaction Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="bg-qrl-primary/50 rounded-lg p-4">
              <div class="text-sm text-qrl-text-secondary mb-1">Confirmations</div>
              <div class="text-md font-mono text-qrl-text">
                {{#if isConfirmed}} {{confirmations}} confirmations {{else}}Unconfirmed{{/if}}
              </div>
            </div>
            <div class="bg-qrl-primary/50 rounded-lg p-4">
              <div class="text-sm text-qrl-text-secondary mb-1">Block</div>
              <div class="text-md font-mono text-qrl-text">
                <a href="/block/{{tx.header.block_number}}" class="text-qrl-accent hover:text-qrl-accent/80">
                  {{tx.header.block_number}}
                </a>
              </div>
            </div>
            <div class="bg-qrl-primary/50 rounded-lg p-4">
              <div class="text-sm text-qrl-text-secondary mb-1">Nonce</div>
              <div class="text-md font-mono text-qrl-text">{{tx.tx.nonce}}</div>
            </div>
            <div class="bg-qrl-primary/50 rounded-lg p-4">
              <div class="text-sm text-qrl-text-secondary mb-1">OTS Key</div>
              <div class="text-md font-mono text-qrl-text">{{ots_key}}</div>
            </div>
            <div class="bg-qrl-primary/50 rounded-lg p-4">
              <div class="text-sm text-qrl-text-secondary mb-1">Fee</div>
              <div class="text-md font-mono text-qrl-text">{{tx.tx.fee}} Quanta</div>
            </div>
            <div class="bg-qrl-primary/50 rounded-lg p-4">
              <div class="text-sm text-qrl-text-secondary mb-1">Size</div>
              <div class="text-md font-mono text-qrl-text">{{txSize}}</div>
            </div>
          </div>

          <!-- JSON Metadata -->
          <div class="mt-8 pt-6 border-t border-qrl-border">
            <button class="flex items-center space-x-2 text-qrl-accent hover:text-qrl-accent/80 jsonclick">
              <span>Meta</span>
              <svg class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="jsonbox json p-4 bg-qrl-secondary/50 rounded overflow-auto" style="display: none">
              <!-- JSON content will be populated by JavaScript -->
            </div>
          </div>
        </div>
      {{/if}}
    {{/with}}

    <!-- Copy Success Overlay -->
    {{#if copySuccess}}
      <div class="fixed top-0 left-0 right-0 bottom-0 w-full h-full z-[9999] flex items-center justify-center pointer-events-auto" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; width: 100vw !important; height: 100vh !important;" data-action="dismiss-copy-feedback">
        <div class="bg-qrl-accent text-qrl-primary px-4 py-3 sm:px-6 sm:py-4 rounded-xl shadow-2xl flex items-center gap-2 sm:gap-3 text-base sm:text-lg font-semibold animate-bounce border-2 border-qrl-accent/20 mx-4 max-w-sm">
          <i data-lucide="check" class="w-5 h-5 sm:w-6 sm:h-6"></i>
          <span>Copied!</span>
        </div>
      </div>
    {{/if}}
  </div>
</template>
