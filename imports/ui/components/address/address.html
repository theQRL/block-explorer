<template name="address">
  <div class="space-y-6">
    {{#if addressLoading}}
      <div class="card">
        <div class="flex items-center justify-center py-12">
          <div class="flex flex-col items-center space-y-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-qrl-accent"></div>
            <div class="text-qrl-text-secondary">Loading address data...</div>
          </div>
        </div>
      </div>
    {{else if notFound}}
      <div class="card border-red-500/30 bg-red-500/10">
        <div class="flex items-start space-x-3">
          <div class="flex-shrink-0">
            <i data-lucide="alert-circle" class="h-6 w-6 text-red-400"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-red-400 mb-2">
              Address Not Found
            </h3>
            <p class="text-red-300 break-all">
              State for <span class="font-mono">{{address.parameter}}</span> not found on this chain.<br>
              Is this address from a different QRL network?
            </p>
          </div>
        </div>
      </div>
    {{else}}
      <!-- Address Header -->
      <div class="card">
        <div class="mb-4">
          <div class="hero-label mb-3">ADDRESS</div>
          <div class="hash-banner flex items-center gap-3 address-container">
            <span class="flex-1 min-w-0 truncate" title="{{address.state.address}}">
              {{address.state.address}}
              {{#if knownProviderNonSpecific}}
                <i data-lucide="check-circle" class="inline-block w-4 h-4 text-qrl-accent ml-2" title="Verified NFT Provider"></i>
              {{/if}}
            </span>
            <button class="copy-address-btn flex items-center gap-2 px-3 py-2 bg-qrl-accent/10 hover:bg-qrl-accent/20 text-qrl-accent rounded-lg transition-colors duration-200 text-sm font-medium min-h-[40px] cursor-pointer flex-shrink-0" title="Copy address to clipboard" style="pointer-events: auto !important;">
              <i data-lucide="copy" class="w-4 h-4 flex-shrink-0 pointer-events-none"></i>
              <span class="hidden sm:inline whitespace-nowrap pointer-events-none">Copy</span>
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-qrl-border">
              <tbody class="bg-qrl-secondary divide-y divide-qrl-border">
                <tr>
                  <td class="px-4 py-3 text-base sm:text-lg md:text-xl lg:text-2xl font-bold font-mono text-qrl-text whitespace-nowrap">
                    {{address.state.address}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Balance Section -->
        <div class="flex justify-center mb-6">
          <div class="w-full max-w-md">
            <div class="text-center bg-qrl-surface/50 rounded-xl p-6 shadow-inner-glow">
              <div class="mb-2">
                <span class="badge-pill badge-pill-transfer">
                  {{#if isMultiSig}}
                    MultiSig Balance
                  {{else}}
                    Balance
                  {{/if}}
                </span>
              </div>
              <div class="hero-number text-gradient relative group cursor-help" data-tooltip="USD ${{balanceUSD}}">
                {{address.state.balance}}
                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-qrl-primary text-qrl-text text-sm rounded-lg shadow-lg opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10">
                  USD ${{balanceUSD}}
                  <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-qrl-primary"></div>
                </div>
              </div>
              <div class="text-qrl-text-secondary mt-1">
                Quanta
              </div>
            </div>
          </div>


        </div>

        <!-- Address Details -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
            <div class="hero-label">Transactions</div>
            <div class="mono-value text-lg">{{address.state.transaction_hash_count}}</div>
          </div>
          {{#unless isMultiSig}}
            <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
              <div class="hero-label">Nonce</div>
              <div class="mono-value text-lg">{{address.state.nonce}}</div>
            </div>
          {{/unless}}
          <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
            <div class="hero-label">Signature Scheme</div>
            <div class="mono-value text-lg">{{addressValidation.signatureScheme}}</div>
          </div>
          {{#unless isMultiSig}}
            <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
              <div class="hero-label">Tree Height</div>
              <div class="mono-value text-lg">{{addressValidation.height}}</div>
            </div>
            <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
              <div class="hero-label">Total Signatures</div>
              <div class="mono-value text-lg">{{addressValidation.totalSignatures}}</div>
            </div>
            <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
              <div class="hero-label">Signatures Remaining</div>
              <div class="mono-value text-lg">{{addressValidation.keysRemaining}}</div>
            </div>
          {{/unless}}
          <div class="bg-qrl-surface/50 rounded-xl p-4 shadow-inner-glow">
            <div class="hero-label">Hash Function</div>
            <div class="mono-value text-lg">{{addressValidation.hashFunction}}</div>
          </div>
        </div>
      </div>

      {{#if isMultiSig}}
        <!-- MultiSig Signatories -->
        <div class="card">
          <h3 class="text-xl font-bold text-qrl-text mb-4">Signatories</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-qrl-secondary/50">
                <tr>
                  <th class="text-left p-3 text-qrl-text">Address</th>
                  <th class="text-left p-3 text-qrl-text">Weight</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-qrl-border">
                {{#each signatories 'MULTISIG'}}
                  <tr class="hover:bg-qrl-secondary/30">
                    <td class="p-3">
                      <a href="/a/{{ this.address_hex}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono break-all">
                        {{ this.address_hex}}
                      </a>
                    </td>
                    <td class="p-3 text-qrl-text">{{ this.weight }}</td>
                  </tr>
                {{/each}}
              </tbody>
              <tfoot class="bg-qrl-secondary/50">
                <tr>
                  <th class="text-left p-3 text-qrl-text">Threshold for spend</th>
                  <th class="text-left p-3 text-qrl-text">{{ threshold }}</th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      {{else}}
        <!-- Tabs Section -->
        <div class="card">
          <div id="addressTabs" class="flex border-b border-qrl-border mb-6 border-gradient-bottom">
            <button class="tab-button active" data-tab="transactions">Quanta</button>
            <button class="tab-button" data-tab="tokenBalances">Tokens</button>
            <button class="tab-button" data-tab="nftBalances">NFTs</button>
            <button class="tab-button" data-tab="otsTrackerTab">OTS</button>
            <button class="tab-button" data-tab="slavesTab">Slaves</button>
          </div>

          <!-- Transactions Tab -->
          <div class="tab-content active" data-tab="transactions">
            <h2 class="text-xl font-bold text-qrl-text mb-4">Transactions</h2>

            <!-- Loading State -->
            <div id="loadingTransactions" class="card">
              <div class="flex items-center justify-center py-12">
                <div class="text-center">
                  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-qrl-accent mx-auto mb-4"></div>
                  <div class="text-qrl-text-secondary">
                    <div class="font-semibold mb-2">Just a moment</div>
                    <p id="relayingMsg">Transaction history loading ...</p>
                  </div>
                </div>
              </div>
            </div>

            {{#if addressHasTransactions}}
              <div class="space-y-4">
                {{#each addressTransactions}}
                  {{#if isTransfer this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-transfer transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            {{#if isThisAddress this.addr_from}}
                              <i data-lucide="arrow-right" class="w-6 h-6 text-qrl-primary"></i>
                            {{else}}
                              <i data-lucide="arrow-up" class="w-6 h-6 text-qrl-primary"></i>
                            {{/if}}
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">
                              {{#if isThisAddress this.addr_from}}
                                Sent
                              {{else}}
                                Received
                              {{/if}}
                            </h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{#if isThisAddress this.addr_from}} {{totalTransferred this}} {{else}} {{receivedAmount this}} {{/if}} Quanta →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono min-w-0 max-w-full">
                            {{#if isThisAddress this.addr_from}}
                              {{#each sendingOutputs this}}
                                <div class="min-w-0 flex-1 flex items-center gap-1"><span class="whitespace-nowrap">{{this.amount}} →</span><a href="/a/{{this.to}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono truncate min-w-0">{{this.to}}</a></div>
                              {{/each}}
                            {{else}}
                              <div class="min-w-0 flex-1"><a href="/a/{{this.addr_from}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono truncate block">{{#if bech32}}{{this.addr_from}}{{else}}{{this.addr_from}}{{/if}}</a></div>
                            {{/if}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isTokenCreation this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-token transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            {{#if isCreateNFT}}
                              <i data-lucide="image" class="w-6 h-6 text-qrl-primary"></i>
                            {{else}}
                              <i data-lucide="coins" class="w-6 h-6 text-qrl-primary"></i>
                            {{/if}}
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">
                              {{#if isCreateNFT}}
                                Create NFT
                                {{#if knownProvider}}
                                  <i data-lucide="check-circle" class="inline-block w-4 h-4 text-qrl-accent ml-1" title="Verified NFT Provider"></i>
                                {{/if}}
                              {{else}}
                                Token Creation
                              {{/if}}
                            </h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{#if isCreateNFT}}
                                  View Tx →
                                {{else}}
                                  {{this.token.symbol}} →
                                {{/if}}
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">
                            {{#if isCreateNFT}}
                              {{#if knownProvider}}
                                <a href="{{providerURL}}/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80">{{providerName}}</a> ({{providerID}}) |
                              {{else}}
                                Unknown provider {{providerID}} |
                              {{/if}}
                            {{else}}
                              {{this.token.name}} ({{this.token.symbol}}) |
                            {{/if}}
                            {{this.timestamp}}
                          </p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isTokenTransfer this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-token transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            {{#if isThisAddress this.addr_from}}
                              <i data-lucide="arrow-right" class="w-6 h-6 text-qrl-primary"></i>
                            {{else}}
                              <i data-lucide="arrow-up" class="w-6 h-6 text-qrl-primary"></i>
                            {{/if}}
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">
                              {{#if isThisAddress this.addr_from}}
                                {{#if isNFTTransfer}}NFT Sent{{else}}Tokens Sent{{/if}}
                              {{else}}
                                {{#if isNFTTransfer}}NFT Received{{else}}Tokens Received{{/if}}
                              {{/if}}
                              {{#if isNFTTransfer}}
                                {{#if knownProvider}}
                                  <i data-lucide="check-circle" class="inline-block w-4 h-4 text-qrl-accent ml-1" title="Verified NFT Provider"></i>
                                {{/if}}
                              {{/if}}
                            </h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{#if isNFTTransfer}}
                                  View Tx →
                                {{else}}
                                  {{receivedTokens this}} →
                                {{/if}}
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">
                            {{#if isNFTTransfer}}
                              {{#if knownProvider}}
                                <a href="{{providerURL}}/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80">{{providerName}}</a> ({{providerID}}) |
                              {{else}}
                                Unknown provider {{providerID}} |
                              {{/if}}
                            {{/if}}
                            {{this.timestamp}}
                          </p>
                          <div class="text-sm text-qrl-text-secondary font-mono min-w-0 max-w-full">
                            {{#if isNFTTransfer}}
                              {{this.transaction_hash}}
                            {{else}}
                              {{#if isThisAddress this.addr_from}}
                                {{#each this.outputs}}
                                  <div class="min-w-0 flex-1 flex items-center gap-1"><span class="whitespace-nowrap">{{this.amount}} →</span><a href="/a/{{this.address_hex}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono truncate min-w-0">{{this.address_hex}}</a></div>
                                {{/each}}
                              {{else}}
                                <div class="min-w-0 flex-1"><a href="/a/{{this.from}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono truncate block">{{this.from}}</a></div>
                              {{/if}}
                            {{/if}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isCoinbaseTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-coinbase transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="star" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">Coinbase Received</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{coinbaseValue}} Quanta →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono min-w-0 max-w-full">
                            <div class="min-w-0 flex-1">
                              {{#if bech32}}<a href="/a/{{this.from_b32}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono truncate block">{{this.from_b32}}</a>{{else}}<a href="/a/{{this.from_hex}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono truncate block">{{this.from_hex}}</a>{{/if}}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isSlaveTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-slave transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="folder-tree" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">Slave Transaction</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{this.amount}} Quanta →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isMultiSigCreateTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-multisig transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="users" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">MultiSig CREATE</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{signatories this}} →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isMultiSigSpendTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-multisig transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="users" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">MultiSig SPEND</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{msSpendAmount this}} Quanta →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isMultiSigVoteTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-multisig transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="users" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">MultiSig VOTE</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                {{msVoteStatus this}} →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isLatticePKTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-lattice transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="grid-3x3" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">Lattice Public Key</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                View Transaction →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isMessageTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-message transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="message-circle" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">Message</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                View Transaction →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isKeybaseTxn this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-message transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="message-circle" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">Keybase</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                View Transaction →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}

                  {{#if isDocumentNotarisation this.transactionType}}
                    <div class="card hover:border-qrl-accent/50 border-type-message transactionRecord cursor-pointer">
                      <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="message-circle" class="w-6 h-6 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-qrl-text">Document Notarisation</h3>
                            <div class="text-right">
                              <a href="/tx/{{this.transaction_hash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-semibold">
                                View Transaction →
                              </a>
                            </div>
                          </div>
                          <p class="text-sm text-qrl-text-secondary mb-2">{{this.timestamp}}</p>
                          <div class="text-sm text-qrl-text-secondary font-mono break-all">
                            {{this.transaction_hash}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/if}}
                {{/each}}
              </div>
            {{else}}
              <div id="noTransactionsFound" style="display: none;" class="card">
                <div class="text-center py-12">
                  <div class="text-qrl-text-secondary">
                    <h3 class="text-lg font-semibold mb-2">No transactions found</h3>
                  </div>
                </div>
              </div>
            {{/if}}

            <!-- Pagination -->
            {{#if pagination}}
              <div class="card mt-6">
                <div class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0">
                  <div class="flex items-center space-x-2">
                    <label for="paginator" class="text-sm text-qrl-text-secondary">Page</label>
                    <input type="text" placeholder="{{currentPage}}" id="paginator" class="w-16 px-2 py-1 bg-qrl-secondary border border-qrl-border rounded text-qrl-text text-center">
                    <span class="text-sm text-qrl-text-secondary">of {{totalPages}}</span>
                  </div>
                  <div class="flex items-center space-x-1 pagination-buttons">
                    {{#if pback}}
                      <button qrl-data="back" class="px-3 py-1 text-sm border border-qrl-border rounded hover:bg-qrl-secondary text-qrl-text">
                        ←
                      </button>
                    {{/if}}
                    {{#each pages}}
                      <button qrl-data="{{this.number}}" class="page-btn px-3 py-1 text-sm border border-qrl-border rounded hover:bg-qrl-secondary text-qrl-text {{#if isActive}}bg-qrl-accent text-qrl-primary{{/if}}">
                        {{this.number}}
                      </button>
                    {{/each}}
                    {{#if pforward}}
                      <button qrl-data="forward" class="px-3 py-1 text-sm border border-qrl-border rounded hover:bg-qrl-secondary text-qrl-text">
                        →
                      </button>
                    {{/if}}
                  </div>
                </div>
              </div>
            {{/if}}
          </div>

          <!-- Token Balances Tab -->
          <div class="tab-content" data-tab="tokenBalances">
            <h2 class="text-xl font-bold text-qrl-text mb-4">Token Balances</h2>

            <div id="tokenBalancesLoading" class="card">
              <div class="flex items-center justify-center py-12">
                <div class="text-center">
                  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-qrl-accent mx-auto mb-4"></div>
                  <div class="text-qrl-text-secondary">
                    <div class="font-semibold mb-2">Just a moment</div>
                    <p>Token balances are loading...</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              {{#if ownTokens}}
                {{#each tokensHeld}}
                  {{#unless heldTokenIsNFT}}
                    <div class="card hover:bg-qrl-secondary/80 transition-colors duration-200">
                      <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="activity" class="w-5 h-5 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1">
                          <h3 class="text-lg font-semibold text-qrl-text">
                            <a href="/tx/{{this.hash}}" class="text-qrl-accent hover:text-qrl-accent/80">
                              {{this.name}} ({{this.symbol}})
                            </a>
                          </h3>
                          <p class="text-qrl-text-secondary">{{this.balance}}</p>
                        </div>
                      </div>
                    </div>
                  {{/unless}}
                {{/each}}
              {{else}}
                <div class="text-center py-8 text-qrl-text-secondary">
                  No tokens owned
                </div>
              {{/if}}
            </div>
          </div>

          <!-- NFTs Tab -->
          <div class="tab-content" data-tab="nftBalances">
            <h2 class="text-xl font-bold text-qrl-text mb-4">NFTs</h2>

            <div id="nftBalancesLoading" class="card">
              <div class="flex items-center justify-center py-12">
                <div class="text-center">
                  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-qrl-accent mx-auto mb-4"></div>
                  <div class="text-qrl-text-secondary">
                    <div class="font-semibold mb-2">Just a moment</div>
                    <p>NFTs are loading...</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              {{#if ownNFTs}}
                {{#each tokensHeld}}
                  {{#if heldTokenIsNFT}}
                    <div class="card hover:bg-qrl-secondary/80 transition-colors duration-200">
                      <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-qrl-accent rounded-lg flex items-center justify-center">
                            <i data-lucide="image" class="w-5 h-5 text-qrl-primary"></i>
                          </div>
                        </div>
                        <div class="flex-1">
                          <h3 class="text-lg font-semibold text-qrl-text">
                            {{#if this.nft.providerDetails.known}}
                              <a href="{{this.nft.providerDetails.url}}/{{this.nft.txhash}}" class="text-qrl-accent hover:text-qrl-accent/80">
                                {{this.nft.providerDetails.name}} (0x{{this.nft.id}})
                              </a>
                              <svg class="inline-block w-4 h-4 text-qrl-accent ml-1" fill="currentColor" viewBox="0 0 20 20" title="Verified NFT Provider">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                              </svg>
                              <span class="text-sm text-qrl-text-secondary">Verified Provider</span>
                            {{else}}
                              <i data-lucide="alert-triangle" class="inline-block w-4 h-4 text-yellow-400 mr-1" title="Unverified NFT Provider"></i>
                              <span class="text-yellow-400">Unverified Provider (0x{{this.nft.id}})</span>
                            {{/if}}
                          </h3>
                          <p class="text-qrl-text-secondary">
                            <a href="/tx/{{this.nft.txhash}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono break-all">
                              {{this.nft.txhash}}
                            </a>
                          </p>
                        </div>
                      </div>
                    </div>
                  {{/if}}
                {{/each}}
              {{else}}
                <div class="text-center py-8 text-qrl-text-secondary">
                  No NFTs owned
                </div>
              {{/if}}
            </div>
          </div>

          <!-- OTS Tracker Tab -->
          <div class="tab-content" data-tab="otsTrackerTab">
            <h2 class="text-xl font-bold text-qrl-text mb-4">OTS Tracker</h2>
            <div class="card border-yellow-500/30 bg-yellow-500/10 mb-6">
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <i data-lucide="alert-triangle" class="h-6 w-6 text-yellow-400"></i>
                </div>
                <div>
                  <h4 class="text-lg font-semibold text-yellow-400 mb-2">Warning</h4>
                  <p class="text-yellow-300 mb-2">The OTS tracker uses the blockchain to determine OTS key usage. It will not account for transactions which have not yet been confirmed into the blockchain.</p>
                  <p class="text-yellow-300">More about OTS key use is contained in the <a href="https://docs.theqrl.org" class="text-yellow-200 hover:text-yellow-100 underline">documentation</a></p>
                </div>
              </div>
            </div>
            <div class="card">
              {{> otsTrackerTemplate}}
            </div>
          </div>

          <!-- Slaves Tab -->
          <div class="tab-content" data-tab="slavesTab">
            <h2 class="text-xl font-bold text-qrl-text mb-4">Slave Addresses</h2>
            {{#if hasSlaves}}
              <div class="space-y-2">
                {{#each slaves}}
                  <div class="card hover:bg-qrl-secondary/80 transition-colors duration-200">
                    <div class="slave-address">
                      <a href="/a/{{this.slave_address}}" class="text-qrl-accent hover:text-qrl-accent/80 font-mono break-all">
                        {{this.slave_address}}
                      </a>
                    </div>
                  </div>
                {{/each}}
              </div>
            {{else}}
              <div class="text-center py-8 text-qrl-text-secondary">
                None found for this address
              </div>
            {{/if}}
          </div>
        </div>
      {{/if}}

      <!-- JSON Metadata -->
      <div class="card">
        <button class="flex items-center space-x-2 text-qrl-accent hover:text-qrl-accent/80 jsonclick">
          <span>Meta</span>
          <svg class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div class="jsonbox json p-4 bg-qrl-secondary/50 rounded overflow-auto" style="display: none">
          <!-- JSON content will be populated by JavaScript -->
        </div>
      </div>
    {{/if}}
  </div>
  
  <!-- Copy Success Overlay -->
  {{#if copySuccess}}
    <div class="fixed top-0 left-0 right-0 bottom-0 w-full h-full z-[9999] flex items-center justify-center pointer-events-auto" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; width: 100vw !important; height: 100vh !important;" data-action="dismiss-copy-feedback">
      <div class="bg-qrl-accent text-qrl-primary px-4 py-3 sm:px-6 sm:py-4 rounded-xl shadow-2xl flex items-center gap-2 sm:gap-3 text-base sm:text-lg font-semibold animate-bounce border-2 border-qrl-accent/20 mx-4 max-w-sm">
        <i data-lucide="check" class="w-5 h-5 sm:w-6 sm:h-6"></i>
        <span>Copied!</span>
      </div>
    </div>
  {{/if}}
</template>

<template name="otsTrackerTemplate">
  {{#if otsTrackerData}}
    {{#if otsTrackerData.error}}
      <div class="p-2 text-center text-xs text-red-400">{{otsTrackerData.error}}</div>
    {{else}}
      {{#if otsTrackerData.empty}}
        <div class="p-2 text-center text-xs text-gray-400">{{otsTrackerData.empty}}</div>
      {{else}}
        {{#if otsTrackerData.cells}}
          <style>
            .ots-responsive-grid {
              display: grid;
              grid-template-columns: repeat(5, 1fr);
              gap: 4px;
              width: 100%;
            }
            @media (min-width: 640px) {
              .ots-responsive-grid { grid-template-columns: repeat(8, 1fr); }
            }
            @media (min-width: 768px) {
              .ots-responsive-grid { grid-template-columns: repeat(10, 1fr); }
            }
            @media (min-width: 1024px) {
              .ots-responsive-grid { grid-template-columns: repeat(10, 1fr); }
            }
            @media (min-width: 1280px) {
              .ots-responsive-grid { grid-template-columns: repeat(10, 1fr); }
            }
          </style>
          <div class="ots-responsive-grid">
            {{#each otsTrackerData.cells}}
              {{#if isUsed}}
                <div class="p-1 sm:p-2 text-center text-sm sm:text-base font-mono border rounded bg-red-500/20 border-gray-500/30 text-red-400" title="Key {{key}}: {{status}}">
                  <i data-lucide="x-circle" class="w-2 h-2 sm:w-3 sm:h-3 inline-block mr-1"></i>{{key}}
                </div>
              {{else}}
                <div class="p-1 sm:p-2 text-center text-sm sm:text-base font-mono border rounded bg-green-500/20 border-gray-500/30 text-green-300" title="Key {{key}}: {{status}}">
                  <i data-lucide="circle" class="w-2 h-2 sm:w-3 sm:h-3 inline-block mr-1"></i>{{key}}
                </div>
              {{/if}}
            {{/each}}
          </div>
        {{/if}}
      {{/if}}
    {{/if}}
  {{/if}}
</template>
